<%- include('./Layouts/Header'); %>

<div class="container mt-5">
  <div class="row mb-4">
    <div class="col-md-6">
      <h1>Uploaded Files</h1>
    </div>
    <div class="col-md-6 text-right">
      <div class="input-group">
        <input type="text" id="searchInput" class="form-control" placeholder="Search...">
        <div class="input-group-append">
          <button class="btn btn-primary" onclick="searchFiles()">Search</button>
        </div>
      </div>
    </div>
  </div>
  <div class="table-responsive">
    <table class="table table-bordered">
      <thead class="thead-light">
        <tr>
          <th>SI No</th>
          <th>Original Name</th>
          <th>File Name</th>
          <th>Upload Date</th>
          <th>View Link</th>
          <!-- <th>Delete</th> -->
        </tr>
      </thead>
      <tbody>
        <% files.forEach((file, index) => { %>
          <tr>
            <td><%= (currentPage - 1) * 10 + index + 1 %></td>
            <td><%= file.originalname %></td>
            <td><%= file.filename %></td>
            <td><%= new Intl.DateTimeFormat('en-US', { dateStyle: 'medium', timeStyle: 'short' }).format(new Date(file.date)) %></td>
            <td><a href="/uploads/<%= file.filename %>" target="_blank" class="btn btn-primary btn-sm">View</a></td>
            <!-- <td>
              <button onclick="deleteFile('<%= file.filename %>')">Delete</button>
            </td> -->
          </tr>
        <% }); %>
      </tbody>
    </table>
  </div>
  <nav aria-label="Page navigation">
    <ul class="pagination">
      <% for(let i = 1; i <= totalPages; i++) { %>
        <li class="page-item <%= currentPage === i ? 'active' : '' %>">
          <a class="page-link" href="?page=<%= i %>&limit=<%= limit %>"><%= i %></a>
        </li>
      <% } %>
    </ul>
  </nav>
</div>

<script>
  function searchFiles() {
    const searchInput = document.getElementById('searchInput').value.trim().toLowerCase();
    const rows = document.querySelectorAll('tbody tr');
    rows.forEach(row => {
      const fileName = row.cells[2].textContent.trim().toLowerCase();
      if (fileName.includes(searchInput)) {
        row.style.display = '';
      } else {
        row.style.display = 'none';
      }
    });
  }
</script>

<%- include('./Layouts/Footer'); %>
